 /* --- Variables --- */
 :root {
            --bg-primary: #1E1E2D; /* Dark blue-grey */
            --bg-secondary: #27293D; /* Slightly lighter */
            --bg-tertiary: #3B3D53; /* Lighter for hover/cards */
            --bg-modal: #2A2D42; /* Modal background */
            --bg-sidebar: #1A1A2E; /* Very dark sidebar */
            --text-primary: #E0E0E0; /* Light grey text */
            --text-secondary: #A0A0B0; /* Medium grey text */
            --text-placeholder: #707080; /* Darker placeholder */
            --accent-primary: #6A5AE0; /* Purple accent */
            --accent-primary-hover: #7B6CF0; /* Lighter purple for hover */
            --border-color: #3B3D53; /* Same as tertiary bg */
            --border-color-light: #4a4d64; /* Lighter border */
            --code-bg: #2D2D44; /* Background for code blocks */
            --error-color: #FF6B6B;
            --success-color: #6BCB77;
            --popover-bg: #3B3D53;
            --popover-hover-bg: #4a4d64;
            --scrollbar-thumb: var(--bg-tertiary);
            --scrollbar-track: var(--bg-primary);
            --progress-bg: var(--bg-tertiary);
            --progress-value: var(--accent-primary);
            --toggle-bg-off: var(--bg-tertiary);
            --toggle-bg-on: var(--accent-primary);
            --toggle-slider: #E0E0E0;

            --sidebar-width: 260px;
            --sidebar-collapsed-width: 80px; /* Adjusted */
            --header-height: 60px;
            --input-area-height: auto; /* Let it grow */
            --border-radius: 8px;
            --border-radius-small: 4px;
            --font-family: 'Inter', sans-serif;
            --modal-max-width: 800px; /* Default modal width */
            --upgrade-modal-max-width: 1000px; /* For the new upgrade plan modal */
        }

        .light-mode {
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8F9FA;
            --bg-tertiary: #E9ECEF;
            --bg-modal: #FFFFFF;
            --bg-sidebar: #F1F3F5;
            --text-primary: #212529;
            --text-secondary: #6C757D;
            --text-placeholder: #adb5bd;
            --accent-primary: #5A4AE0; /* Slightly darker purple for light mode */
            --accent-primary-hover: #4A3AD0;
            --border-color: #DEE2E6;
            --border-color-light: #ced4da;
            --code-bg: #F1F3F5;
            --popover-bg: #FFFFFF; /* Use white for light mode popovers */
            --popover-hover-bg: #F1F3F5; /* Use light grey for light mode popover hover */
            --scrollbar-thumb: #ced4da;
            --scrollbar-track: #F8F9FA;
            --progress-bg: var(--bg-tertiary);
            --progress-value: var(--accent-primary);
            --toggle-bg-off: #ccc;
            --toggle-bg-on: var(--accent-primary);
            --toggle-slider: #fff;
            --error-color: #dc3545;
            --success-color: #198754;
        }


        /* --- Base & Resets --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            overflow: hidden; /* Prevent scrolling on body */
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            transition: background-color 0.3s ease, color 0.3s ease;
            font-size: 14px; /* Base font size */
        }
        body.modal-open, body.confirm-dialog-open, body.popover-open { /* Add class for confirm dialog & popover */
            overflow: hidden; /* Prevent body scroll when modal/popover is open */
        }
        /* Sidebar Visibility Control */
        body.sidebar-open .sidebar {
            transform: translateX(0);
        }

        /* Simple class for larger font mode */
        body.large-font-mode {
            font-size: 15px; /* Increase base font size */
        }

        /* --- General Elements --- */
        button, input, select, textarea {
            font-family: inherit;
            font-size: 1em; /* Inherit base font size */
            color: inherit;
            border: 1px solid var(--border-color-light);
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-small);
            padding: 8px 12px;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }
        button {
            cursor: pointer;
            border: none;
            background: none;
            padding: 8px 12px;
            border-radius: var(--border-radius-small);
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
            display: inline-flex; /* Align icon and text */
            align-items: center;
            justify-content: center; /* Center content by default */
            gap: 8px;
            line-height: 1.2; /* Prevent excessive height */
        }
        textarea {
            resize: none; /* Disabled resize handle, JS handles height */
            width: 100%;
            line-height: 1.5;
            overflow-y: hidden; /* Hide scrollbar initially, JS adjusts */
        }
        input::placeholder, textarea::placeholder {
            color: var(--text-placeholder);
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-primary) 30%, transparent); /* Focus ring */
        }
        select {
            appearance: none;
            padding-right: 30px; /* Space for arrow */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23A0A0B0' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E"); /* Basic dropdown arrow */
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px;
        }
        .light-mode select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%236C757D' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
        }

        button:hover:not(:disabled) {
            background-color: var(--bg-tertiary);
        }
        button.btn-primary {
            background-color: var(--accent-primary);
            color: white;
            border: none;
        }
        button.btn-primary:hover:not(:disabled) {
            background-color: var(--accent-primary-hover);
        }
        button.btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        button.btn-secondary:hover:not(:disabled) {
            background-color: var(--border-color-light);
        }
        /* Danger Button Style */
        button.btn-danger {
            background-color: var(--error-color);
            color: white;
            border: none;
        }
        button.btn-danger:hover:not(:disabled) {
            background-color: color-mix(in srgb, var(--error-color) 85%, black);
        }

        button.btn-small {
            padding: 4px 8px;
            font-size: 0.9em;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* MODIFIED: General avatar style for both img and svg */
        img.avatar, svg.avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover; /* For img tags */
            flex-shrink: 0;
        }

        img.modal-avatar { /* This can remain specific to img if modal always uses img */
            width: 64px;
            height: 64px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
        }
        .mr-3{
            margin-right: 30px;
        }

        svg {
            vertical-align: middle;
            fill: none; /* Default for outline icons */
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            flex-shrink: 0;
            width: 1em;
            height: 1em;
        }

        /* Avatar SVGs specific styling (for message bubbles and sidebar) */
        .message svg.avatar,
        .sidebar-footer .user-profile-button svg.avatar {
            fill: currentColor; /* Allow fill for these avatar SVGs */
            stroke: none;       /* No stroke needed for these simple avatars */
        }
        .message svg.avatar { /* Slightly different size for message bubbles */
            width: 36px;
            height: 36px;
        }

        #profile-section .form-group input[type="text"],
        #profile-section .form-group input[type="email"] {
            width: 100%;
        }

        /* Specific icon sizes */
        .logo svg { width: 24px; height: 24px; }
        .new-chat-container svg { width: 20px; height: 20px; }
        .token-count svg { width: 16px; height: 16px; }
        .theme-toggle svg { width: 18px; height: 18px; }
        .user-profile-popover svg { width: 18px; height: 18px; }
        .message-actions svg { width: 16px; height: 16px; }
        .copy-code-btn svg { width: 14px; height: 14px; }
        .modal-header svg { width: 20px; height: 20px; }
        .modal-nav-item svg { width: 18px; height: 18px; }
        .usage-meter svg { width: 14px; height: 14px; }
        .mobile-menu-toggle svg { width: 24px; height: 24px; }
        .sidebar-toggle-btn svg { width: 20px; height: 20px;}
        .search-btn svg { width: 18px; height: 18px; }
        .history-options-btn svg { width: 16px; height: 16px; }
        .history-context-menu svg { width: 14px; height: 14px; margin-right: 8px;}
        #mobile-new-chat-btn svg { width: 20px; height: 20px;}
        .chat-search-popover .popover-item svg { width: 18px; height: 18px; margin-right: 10px; }
        .upgrade-plan-card .feature-list-item svg { width: 16px; height: 16px; margin-right: 8px; fill: var(--accent-primary); stroke: none; }


        /* --- Scrollbars --- */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: var(--scrollbar-thumb);
            border-radius: 4px;
            border: 2px solid var(--scrollbar-track); /* Padding around thumb */
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: var(--text-secondary);
        }
        /* Thin scrollbar for history */
        .chat-history::-webkit-scrollbar { width: 6px; }
        .chat-history::-webkit-scrollbar-thumb { border: 1px solid var(--scrollbar-track); }
        /* Hide scrollbar */
        .modal-nav::-webkit-scrollbar { width: 0; height: 0; }


        /* --- Layout --- */
        .chat-container {
            display: flex;
            width: 100%;
            height: 100vh;
            position: relative; /* For mobile toggle positioning */
        }

        /* --- Sidebar --- */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-sidebar);
            padding: 15px;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            border-right: 1px solid var(--border-color);
            transition: transform 0.3s ease, background-color 0.3s ease, border-color 0.3s ease, width 0.3s ease; /* Added width transition */
            position: relative; /* For popover */
            z-index: 100; /* Below popover/modals but above chat */
        }
        /* Collapsed State */
        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width); /* Use variable */
            padding: 15px 10px;
        }
        .sidebar.collapsed .logo span,
        .sidebar.collapsed .new-chat-btn span,
        .sidebar.collapsed .history-group h4,
        .sidebar.collapsed .history-item-content span, /* Target span inside content */
        .sidebar.collapsed .token-count span,
        .sidebar.collapsed .theme-toggle span,
        .sidebar.collapsed .user-info,
        .sidebar.collapsed .mobile-sidebar-close-btn /* Hide mobile close button in collapsed desktop view */ {
            display: none;
            opacity: 0; /* Fade out text */
            pointer-events: none; /* Prevent interaction */
        }
        .sidebar.collapsed .logo { justify-content: center; }
        .sidebar.collapsed .new-chat-container { flex-direction: column; align-items: center; gap: 5px; }
        .sidebar.collapsed .new-chat-btn { width: auto; padding: 10px; } /* Smaller padding */
        .sidebar.collapsed .search-btn { width: auto; padding: 10px; } /* Smaller padding */
        .sidebar.collapsed .history-group ul { padding-left: 0; }
        .sidebar.collapsed .history-list-item { justify-content: center; }
        .sidebar.collapsed .history-item { justify-content: center; padding: 10px; width: auto; flex-grow: 0;} /* Center icon */
        .sidebar.collapsed .history-item-content { display: none; } /* Hide text wrapper */
        .sidebar.collapsed .history-options-btn { right: -5px; } /* Adjust options btn pos */
        .sidebar.collapsed .sidebar-footer > * { justify-content: center; padding: 10px; }
        .sidebar.collapsed .sidebar-footer > button span, .sidebar.collapsed .token-count span { display: none; } /* Ensure text is hidden */
        /* Adjust user profile popover pos when sidebar is collapsed */
        .sidebar.collapsed .user-profile-popover {
             left: calc(var(--sidebar-collapsed-width) + 5px);
             bottom: 10px;
             width: 200px;
        }


        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Space for toggle */
            margin-bottom: 20px;
            padding: 5px 0;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text-primary);
            transition: opacity 0.2s ease;
            flex-grow: 1; /* Allow logo to take space */
        }
        .logo svg {
            color: var(--accent-primary); /* Logo icon color */
        }

        /* Sidebar Toggle Button (Desktop) */
        .sidebar-toggle-btn {
            padding: 5px; /* Consistent padding */
            color: var(--text-secondary);
            display: none; /* Hidden by default, shown on desktop */
            margin-left: auto; /* Push to the right if logo takes available space */
            flex-shrink: 0; /* Prevent shrinking */
        }
        .sidebar-toggle-btn:hover {
            color: var(--text-primary);
            background-color: var(--bg-tertiary);
        }


        .new-chat-container { /* Wrapper for New Chat + Search */
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
        }
        .new-chat-btn {
            background-color: var(--accent-primary);
            color: white;
            flex-grow: 1; /* Take available space */
            text-align: left;
            justify-content: flex-start; /* Align content left */
            padding: 10px 15px;
            margin-bottom: 0; /* Remove bottom margin */
            font-weight: 500;
            overflow: hidden; /* Prevent text overflow issues */
            border: 1px solid transparent; /* Add transparent border for consistent sizing with hover */
        }
        .new-chat-btn span { white-space: nowrap; }
        .new-chat-btn:hover { background-color: var(--accent-primary-hover); }
        /* Corrected fill for new chat button SVG */
        .new-chat-btn svg { stroke: white; fill: none; }

        .search-btn {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 10px;
            flex-shrink: 0; /* Don't shrink */
            border: 1px solid var(--border-color);
        }
        .search-btn:hover {
            background-color: var(--border-color-light);
            color: var(--text-primary);
        }

        /* Light Mode Specific Hovers for New Chat and Search Buttons */
        .light-mode .new-chat-btn {
            background-color: var(--accent-primary);
            color: white;
        }
        .light-mode .new-chat-btn:hover {
            background-color: var(--accent-primary-hover); /* Use the light mode accent hover */
            color: white;
        }
        .light-mode .new-chat-btn:hover svg {
            stroke: white; /* Keep icon color consistent with text */
        }

        .light-mode .search-btn { /* Default state in light mode */
            background-color: var(--bg-secondary); /* Match hover image default if sidebar is lighter */
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        .light-mode .search-btn:hover {
            background-color: var(--bg-tertiary); /* Slightly darker hover for secondary button */
            color: var(--text-primary);         /* Darker icon text */
            border: 1px solid var(--border-color-light);
        }

        .chat-history {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        .history-group { margin-bottom: 15px; }
        .history-group h4 {
            font-size: 0.8em;
            color: var(--text-secondary);
            margin-bottom: 5px;
            padding: 0 10px;
            text-transform: uppercase;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
        }
        .history-group ul { list-style: none; }

        /* History Item Styling */
        .history-list-item {
            position: relative; /* For context menu positioning */
            display: flex; /* Use flex for alignment */
            align-items: center;
            width: 100%;
            border-radius: var(--border-radius-small);
        }
        .history-list-item:hover {
            background-color: var(--bg-tertiary);
        }
        .history-list-item:hover .history-options-btn {
            opacity: 1; /* Show options btn on hover */
        }

        .history-item { /* The main clickable area */
            flex-grow: 1; /* Take available space */
            text-align: left;
            justify-content: flex-start;
            padding: 8px 10px;
            font-size: 0.9em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border-radius: var(--border-radius-small);
            color: var(--text-secondary);
            /* Remove hover effect from button itself, apply to li */
            background: none !important;
            border: none !important;
            box-shadow: none !important;
        }
        /* Apply active styles to the list item instead of the button */
        .history-list-item.active {
            background-color: var(--bg-secondary) !important;
        }
        .history-list-item.active .history-item {
            font-weight: 500;
            color: var(--text-primary) !important;
        }

        .history-item-content { /* Wrapper for text/input */
            flex-grow: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            /* Added padding right to make space for the options button */
            padding-right: 25px;
            position: relative; /* Ensure it contains the button/input */
            display: flex; /* Allow flex properties */
            align-items: center; /* Vertically align text/input */
            min-height: 36px; /* Match button height roughly */
        }
        .history-item-content > button { /* Style the inner button */
            width: 100%;
            padding: 0; /* Remove inner button padding */
            justify-content: flex-start;
        }

        .history-rename-input {
            width: 100%;
            padding: 2px 5px; /* Minimal padding */
            font-size: inherit; /* Match button font size */
            line-height: 1.2;
            border: 1px solid var(--accent-primary);
            background-color: var(--bg-tertiary);
            margin: 0; /* Reset margin */
            box-shadow: none; /* Remove focus ring inside */
        }

        .history-options-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            padding: 4px;
            color: var(--text-secondary);
            opacity: 0; /* Hidden by default */
            transition: opacity 0.2s ease;
            z-index: 2; /* Above history item */
            line-height: 0; /* Align icon better */
            background: none; /* Ensure no background */
            border: none;
        }
        .history-options-btn:hover {
            color: var(--text-primary);
            background-color: var(--bg-secondary); /* Different hover bg */
        }
        .history-options-btn svg { width: 16px; height: 16px;}

        .history-context-menu {
            position: absolute;
            right: 10px;
            top: 100%; /* Position below the item */
            margin-top: 4px;
            background-color: var(--popover-bg);
            border-radius: var(--border-radius-small);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 1011; /* Above other popovers */
            padding: 5px 0;
            display: none; /* Hidden by default */
            min-width: 120px;
        }
        .history-context-menu.show {
            display: block;
        }
        .history-context-menu button {
            display: flex; /* Align icon and text */
            align-items: center;
            width: 100%;
            padding: 8px 12px;
            font-size: 0.9em;
            text-align: left;
            justify-content: flex-start;
            border-radius: 0; /* No radius inside menu */
            border: none; /* Remove border */
            background: none; /* Remove background */
        }
        .history-context-menu button:hover {
            background-color: var(--popover-hover-bg);
        }
        .history-context-menu button.delete {
            color: var(--error-color);
        }
        .history-context-menu button.delete:hover {
            background-color: color-mix(in srgb, var(--error-color) 20%, var(--popover-hover-bg));
        }


        .sidebar-footer {
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px; /* Reduced gap */
            flex-shrink: 0;
        }

        .token-count, .theme-toggle, .user-profile-button {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            border-radius: var(--border-radius-small);
            font-size: 0.9em;
            width: 100%;
            text-align: left; /* Ensure text aligns left */
            justify-content: flex-start; /* Align icon/text left */
            background: none; /* Remove default button bg */
            border: none; /* Remove default button border */
            color: var(--text-secondary); /* Default color */
        }
        .token-count span, .theme-toggle span, .user-profile-button .user-info {
            flex-grow: 1; /* Allow text to take space */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .token-count:hover, .theme-toggle:hover, .user-profile-button:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }
        .token-count svg, .theme-toggle svg { color: var(--text-secondary); }
        .token-count:hover svg, .theme-toggle:hover svg { color: var(--text-primary); }

        .user-info { display: flex; flex-direction: column; line-height: 1.3; }
        .user-name { font-weight: 500; color: var(--text-primary); /* Make name primary */ }
        .user-email { font-size: 0.85em; color: var(--text-secondary); }


        /* --- Popover Base --- */
        .popover {
            position: absolute;
            background-color: var(--popover-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1010; /* Default popover Z */
            padding: 8px 0;
            opacity: 0; /* Hidden by default */
            transform: translateY(10px) scale(0.95);
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s ease;
            visibility: hidden;
        }
        .popover.show {
            opacity: 1;
            transform: translateY(0) scale(1);
            visibility: visible;
        }
        .popover nav { display: flex; flex-direction: column; }
        .popover-item {
            padding: 10px 15px; width: 100%; text-align: left; font-size: 0.9em;
            border-radius: 0; color: var(--text-primary); justify-content: flex-start;
        }
        .popover-item svg { margin-right: 10px; color: var(--text-secondary); }
        .popover-item:hover { background-color: var(--popover-hover-bg); }
        .popover-item:hover svg { color: var(--text-primary); }
        .popover-item .badge {
            margin-left: auto; background-color: var(--accent-primary); color: white;
            font-size: 0.75em; padding: 2px 6px; border-radius: 10px; font-weight: 500;
        }
        .popover-divider { height: 1px; background-color: var(--border-color); border: none; margin: 8px 0; }

        /* --- Popover Overlay --- */
        .popover-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1040; /* Below popover, above content */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .popover-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* --- User Profile Popover (Specific positioning) --- */
        .user-profile-popover {
            bottom: 65px;
            left: 10px;
            width: calc(100% - 20px);
            transform-origin: bottom left;
             z-index: 1010; /* Keep its original z-index */
        }

        /* --- Chat Search Popover (CENTERED) --- */
        .chat-search-popover {
            position: fixed; /* Position relative to viewport */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95); /* Center and initial scale */
            transform-origin: center center; /* Scale from center */
            width: 90%; /* Responsive width */
            max-width: 550px; /* Max width for the popover */
            max-height: 75vh; /* Limit height */
            z-index: 1045; /* Above overlay */
            display: flex; /* Use flex for internal layout */
            flex-direction: column;
            padding: 0; /* Remove default popover padding */
            background-color: var(--bg-modal); /* Use modal background */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius); /* Consistent rounding */
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25); /* Consistent shadow */
            /* Inherit transition from base .popover, ensure transform is included */
             transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s ease;
        }
        .chat-search-popover.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1); /* Final centered scale */
            visibility: visible;
        }
        .light-mode .chat-search-popover {
            background-color: var(--bg-modal); /* Light mode modal bg */
            border-color: var(--border-color);
        }
        .chat-search-header {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            background-color: var(--bg-secondary); /* Header distinct bg */
            border-radius: var(--border-radius) var(--border-radius) 0 0; /* Round top corners */
        }
        .light-mode .chat-search-header {
             background-color: var(--bg-tertiary);
        }
        #chat-search-input {
            flex-grow: 1;
            background-color: transparent; /* Transparent background */
            border: none;
            padding: 8px 0; /* Remove internal padding if parent has it */
            font-size: 1em;
            color: var(--text-primary);
        }
        #chat-search-input:focus {
            box-shadow: none; /* Remove focus ring as parent handles border */
        }
        #chat-search-input::placeholder {
            color: var(--text-placeholder);
        }
        .chat-search-close-btn {
            padding: 5px;
            color: var(--text-secondary);
            margin-left: 10px;
            background: none;
            border: none;
        }
        .chat-search-close-btn:hover {
            color: var(--text-primary);
            background-color: var(--bg-tertiary);
        }
        .chat-search-close-btn svg { width: 18px; height: 18px; }

        .chat-search-results-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 8px 0; /* Padding for the list */
        }
        .chat-search-popover .new-chat-search-item {
            padding: 12px 15px; /* Match popover-item */
            font-weight: 500;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 5px;
        }
        .chat-search-popover .new-chat-search-item svg {
            stroke: var(--text-secondary); /* Match new chat btn in sidebar */
            fill: none;
        }
        .light-mode .chat-search-popover .new-chat-search-item {
            color: var(--text-primary);
        }
        .light-mode .chat-search-popover .new-chat-search-item svg {
            stroke: var(--text-primary);
        }

        .chat-search-popover .history-group {
            margin-bottom: 0; /* No extra margin between groups */
        }
        .chat-search-popover .history-group h4 {
            padding: 5px 15px; /* Padding for group titles */
            font-size: 0.75em; /* Smaller title */
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            margin-top: 5px; /* Add space above group title */
        }
         .chat-search-popover .history-group:first-of-type h4 {
             border-top: none; /* Remove top border for the very first group */
             margin-top: 0;
        }
        .light-mode .chat-search-popover .history-group h4 {
            border-color: var(--border-color);
        }


        .chat-search-popover .search-result-item {
            padding: 10px 15px; /* Match popover-item */
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary); /* Main text color for items */
        }
        .chat-search-popover .search-result-item svg {
            width: 18px; height: 18px;
            color: var(--text-secondary); /* Icon color */
            stroke-width: 2;
            fill: none;
        }
        .chat-search-popover .search-result-item span {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 0.9em;
        }
        .chat-search-popover .search-result-item:hover {
            background-color: var(--popover-hover-bg);
        }
        .chat-search-popover .search-result-item:hover svg {
            color: var(--text-primary);
        }
        .chat-search-popover .search-result-item.active {
            background-color: var(--accent-primary) !important;
            color: white !important;
        }
        .chat-search-popover .search-result-item.active svg {
            color: white !important;
        }

        /* --- Mobile Menu Toggle (Hamburger to open sidebar) --- */
        .mobile-menu-toggle {
            display: none; /* Hidden on larger screens */
            position: fixed;
            top: 13px;
            left: 15px;
            z-index: 1100;
            color: var(--text-primary);
            background: var(--bg-secondary);
            padding: 8px;
            border-radius: var(--border-radius-small);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
        }

        /* ADDED: Mobile Sidebar Close Button (X icon inside sidebar) */
        .mobile-sidebar-close-btn {
            display: none; /* Hidden by default, shown on mobile inside sidebar */
            padding: 8px; /* Match mobile-menu-toggle padding */
            color: var(--text-secondary);
            background: none;
            border: none;
            margin-left: 5px; /* Add some space from logo */
            flex-shrink: 0; /* Prevent shrinking */
        }
        .mobile-sidebar-close-btn:hover {
            color: var(--text-primary);
            background-color: var(--bg-tertiary);
        }
        .mobile-sidebar-close-btn svg {
            width: 20px;
            height: 20px;
        }

        /* --- Chat Area --- */
        .chat-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: var(--bg-primary);
            transition: background-color 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .chat-header {
            height: var(--header-height);
            display: flex;
            justify-content: space-between; /* Adjusted for mobile new chat button */
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            position: relative;
            transition: border-color 0.3s ease;
        }
        /* Mobile New Chat Button in Header */
        #mobile-new-chat-btn {
            display: none; /* Hidden by default */
            padding: 6px;
            margin-left: -5px; /* Adjust positioning */
        }
        #mobile-new-chat-btn svg {
            width: 22px;
            height: 22px;
            stroke: var(--text-secondary);
        }
        #mobile-new-chat-btn:hover svg {
            stroke: var(--text-primary);
        }
        .mobile-chat-title { display: none; /* JS handles visibility */ }


               /* ============================ */
        /* START: Model Selector Styles */
        /* ============================ */
        .model-selector-container {
            position: relative;
            margin-left: auto;
        }

        .model-selector-trigger-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background-color: transparent;
            color: var(--text-primary);
            border: none;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        .model-selector-trigger-btn:hover {
            background-color: var(--bg-tertiary);
        }
        .model-selector-trigger-btn:focus {
            outline: none;
            box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-primary) 30%, transparent);
        }
        .light-mode .model-selector-trigger-btn { color: var(--text-primary); }
        .light-mode .model-selector-trigger-btn:hover { background-color: var(--bg-tertiary); }


        .model-selector-arrow {
            color: var(--text-secondary);
            transition: transform 0.2s ease;
            fill: currentColor;
            stroke: none;
            width: 12px;
            height: 12px;
        }
        .model-selector-trigger-btn[aria-expanded="true"] .model-selector-arrow {
            transform: rotate(180deg);
        }
        .light-mode .model-selector-arrow { color: var(--text-secondary); }


        .model-selector-popover {
            position: absolute;
            top: calc(100% + 5px);
            right: 0;
            width: 300px;
            background-color: var(--popover-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
            z-index: 1020;
            padding: 8px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px) scale(0.95);
            transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s ease;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .model-selector-popover.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        .light-mode .model-selector-popover {
            background-color: var(--popover-bg);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .model-option-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            transition: background-color 0.2s ease;
            color: var(--text-primary);
        }
        .model-option-item:hover {
            background-color: var(--popover-hover-bg);
        }
        .light-mode .model-option-item { color: var(--text-primary); }
        .light-mode .model-option-item:hover { background-color: var(--popover-hover-bg); }


        .model-option-main-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-grow: 1;
        }

        .model-option-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            fill: currentColor;
            stroke: none;
        }
        .model-option-item[data-model="plus"] .model-option-icon { color: #A670E0; }
         .model-option-item[data-model="default"] .model-option-icon { color: var(--text-secondary); }
        .light-mode .model-option-item[data-model="default"] .model-option-icon { color: var(--text-secondary); }


        .model-option-text { display: flex; flex-direction: column; }
        .model-option-name { font-size: 0.9em; font-weight: 500; color: var(--text-primary); }
        .light-mode .model-option-name { color: var(--text-primary); }

        .model-option-description { font-size: 0.8em; color: var(--text-secondary); }
         .light-mode .model-option-description { color: var(--text-secondary); }

        .model-option-upgrade-btn {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            padding: 6px 12px;
            border-radius: var(--border-radius-small);
            font-size: 0.85em;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .model-option-upgrade-btn:hover { background-color: var(--border-color-light); }
        .light-mode .model-option-upgrade-btn {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        .light-mode .model-option-upgrade-btn:hover { background-color: var(--border-color); }


        .model-option-checkmark {
            color: var(--text-primary);
            visibility: hidden;
            margin-left: 10px;
            fill: currentColor;
            stroke: none;
            width: 16px;
            height: 16px;
        }
        .model-option-item.active .model-option-checkmark { visibility: visible; }
        .model-option-item[data-model="plus"] .model-option-checkmark { display: none; }
         .light-mode .model-option-checkmark { color: var(--text-primary); }
        /* ========================== */
        /* END: Model Selector Styles */
        /* ========================== */


        .messages-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-radius: 15px;
        }
        .messages-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
        }
        .messages-list::after {
            content: '';
            display: block;
            height: 10px;
            flex-shrink: 0;
        }


        /* --- Initial Prompt Area Control --- */
        .initial-prompts-cards {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            padding: 20px 0;
            text-align: center;
            width: 100%;
        }
        .initial-prompts-cards.visible { display: flex; }
        .initial-prompt-title { font-size: 1.8em; font-weight: 600; margin-bottom: 20px; color: var(--text-primary); }
        .prompt-cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; width: 100%; max-width: 800px; margin-bottom: 20px; }
        .prompt-card { background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 15px; text-align: left; display: flex; flex-direction: column; gap: 5px; transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; cursor: pointer; height: 100%; }
        .prompt-card:hover { transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-color: var(--accent-primary); background-color: var(--bg-tertiary); }
        .prompt-card h4 { font-size: 1.0em; font-weight: 600; margin-bottom: 3px; color: var(--text-primary); }
        .prompt-card p { font-size: 0.85em; color: var(--text-secondary); margin-bottom: 8px; flex-grow: 1; }
        .prompt-card span { font-size: 0.8em; color: var(--text-placeholder); line-height: 1.3; }
        .command-suggestions { margin-top: 15px; color: var(--text-secondary); font-size: 0.9em; width: 100%; max-width: 800px; }
        .command-suggestions p { margin-bottom: 10px; text-align: center; padding-left: 0; }
        .command-buttons { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding-left: 0; }
        .command-btn { background-color: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-secondary); padding: 6px 12px; font-size: 0.85em; }
        .command-btn:hover { background-color: var(--bg-tertiary); border-color: var(--border-color-light); color: var(--text-primary); }

        /* --- Message Bubbles --- */
        .message {
            display: flex;
            gap: 15px;
            max-width: 85%;
            align-items: flex-start;
            position: relative;
            padding-bottom: 30px;
        }
        .message-content {
            background-color: var(--bg-secondary);
            padding: 12px 15px;
            border-radius: var(--border-radius);
            line-height: 1.5;
            position: relative;
            flex-grow: 1;
            word-wrap: break-word;
            overflow: hidden;
        }
        .message .avatar {
            width: 36px;
            height: 36px;
            flex-shrink: 0;
            margin-top: 2px;
            border-radius: 50%;
            object-fit: cover;
        }
        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        .user-message .message-content {
            background-color: var(--accent-primary);
            color: white;
        }
        .ai-message {
            align-self: flex-start;
        }

        /* --- Message Attachments --- */
        .message-attachments {
            margin-top: 8px; /* Space above attachments if there's text */
            display: flex;
            flex-direction: column;
            gap: 6px; /* Space between multiple attachments */
        }
        .message-attachment-item {
            background-color: var(--bg-tertiary);
            padding: 6px 10px;
            border-radius: var(--border-radius-small);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em; /* Font for attachment name */
            border: 1px solid var(--border-color);
            color: var(--text-secondary); /* Default text color for attachment item */
        }
        .user-message .message-attachment-item { /* Contrast for attachments in user messages */
            background-color: color-mix(in srgb, var(--accent-primary) 85%, black);
            border-color: color-mix(in srgb, var(--accent-primary) 70%, black);
            color: #e0e0e0; /* Text color for user message attachments */
        }

        .message-attachment-item .file-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* --- File Icons in Messages --- */
        .message-attachment-item .file-icon {
            display: inline-flex; align-items: center; justify-content: center;
            margin-right: 0; flex-shrink: 0; color: inherit;
        }
        .message-attachment-item .file-icon > svg:not(.embedded-svg-content) { width: 18px; height: 18px; }
        .message-attachment-item .file-icon > svg.embedded-svg-content { width: auto; height: auto; max-width: 50px; max-height: 50px; stroke-width: initial; }

        /* --- File Icons/Previews in Previews (Input Area & Modal) --- */
        .file-preview-container .file-preview-item .file-icon svg:not(.embedded-svg-content), /* For generic icons in main input area preview */
        .file-list-display .file-preview-item .file-icon svg:not(.embedded-svg-content) { /* For generic icons in modal if preview fails */
            width: 18px; height: 18px;
        }

        .file-preview-container .file-preview-item .file-icon > svg.embedded-svg-content, /* For SVG icons in main input area preview */
        .file-list-display .file-preview-item .file-icon > svg.embedded-svg-content { /* For SVG icons in modal if preview fails */
            /* This targets the embedded SVG itself when it's inside .file-icon */
            width: auto; height: auto; max-width: 32px; max-height: 32px; stroke-width: initial;
        }
        /* New styles for actual image/SVG previews in the modal */
        .file-list-display .file-preview-item .file-preview-image, /* Targets the <img> tag directly */
        .file-list-display .file-preview-item .file-preview-svg-container { /* Targets the <div> hosting the SVG */
            width: 36px;
            height: 36px;
            margin-right: 8px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 1px solid var(--border-color-light);
            border-radius: var(--border-radius-small);
            background-color: var(--bg-secondary); /* Subtle background for the preview box */
        }
        .file-list-display .file-preview-item .file-preview-image { /* Specifically for <img> */
            object-fit: cover;
        }
        .file-list-display .file-preview-item .file-preview-svg-container svg { /* For <svg> inside the container */
            max-width: 100%;
            max-height: 100%;
        }


        /* Fallback Icon Colors (AI Messages & Modals) */
        .message-attachment-item .file-icon > svg.file-icon-pdf:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-pdf:not(.embedded-svg-content) { fill: #E53935; stroke: none; }
        .message-attachment-item .file-icon > svg.file-icon-doc:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-doc:not(.embedded-svg-content) { fill: #2962FF; stroke: none; }
        .message-attachment-item .file-icon > svg.file-icon-xls:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-xls:not(.embedded-svg-content) { fill: #00897B; stroke: none; }
        .message-attachment-item .file-icon > svg.file-icon-ppt:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-ppt:not(.embedded-svg-content) { fill: #EF6C00; stroke: none; }
        .message-attachment-item .file-icon > svg.file-icon-img:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-img:not(.embedded-svg-content),
        .message-attachment-item .file-icon > svg.file-icon-svg_file:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-svg_file:not(.embedded-svg-content) { fill: var(--accent-primary); stroke: none; }
        .message-attachment-item .file-icon > svg.file-icon-vid:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-vid:not(.embedded-svg-content) { fill: #D81B60; stroke: none; }
        .message-attachment-item .file-icon > svg.file-icon-aud:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-aud:not(.embedded-svg-content) { fill: #8E24AA; stroke: none; }
        .message-attachment-item .file-icon > svg.file-icon-zip:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-zip:not(.embedded-svg-content) { fill: #FDD835; stroke: none; }
        .message-attachment-item .file-icon > svg.file-icon-code:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-code:not(.embedded-svg-content) { stroke: var(--text-secondary); fill: none; }
        .message-attachment-item .file-icon > svg.file-icon-generic:not(.embedded-svg-content),
        .file-list-display .file-icon > svg.file-icon-generic:not(.embedded-svg-content) { stroke: var(--text-secondary); fill: none;}

        /* Fallback Icon Colors (User Messages) */
        .user-message .message-attachment-item .file-icon > svg.file-icon-pdf:not(.embedded-svg-content),
        .user-message .message-attachment-item .file-icon > svg.file-icon-doc:not(.embedded-svg-content),
        .user-message .message-attachment-item .file-icon > svg.file-icon-xls:not(.embedded-svg-content),
        .user-message .message-attachment-item .file-icon > svg.file-icon-ppt:not(.embedded-svg-content),
        .user-message .message-attachment-item .file-icon > svg.file-icon-img:not(.embedded-svg-content),
        .user-message .message-attachment-item .file-icon > svg.file-icon-svg_file:not(.embedded-svg-content),
        .user-message .message-attachment-item .file-icon > svg.file-icon-vid:not(.embedded-svg-content),
        .user-message .message-attachment-item .file-icon > svg.file-icon-aud:not(.embedded-svg-content),
        .user-message .message-attachment-item .file-icon > svg.file-icon-zip:not(.embedded-svg-content) { fill: #FFFFFF; stroke: none; }
        .user-message .message-attachment-item .file-icon > svg.file-icon-code:not(.embedded-svg-content),
        .user-message .message-attachment-item .file-icon > svg.file-icon-generic:not(.embedded-svg-content) { stroke: #FFFFFF; fill: none; }


        /* AI Loader */
        .ai-loader { display: flex; align-items: center; gap: 5px; padding: 8px 0px; min-height: 24px; }
        .ai-loader .dot { width: 8px; height: 8px; margin: 0 3px; background-color: var(--accent-primary); border-radius: 50%; animation: ai-loader-pulse 1.4s infinite ease-in-out both; }
        .ai-loader .dot:nth-child(1) { animation-delay: -0.32s; }
        .ai-loader .dot:nth-child(2) { animation-delay: -0.16s; }
        .ai-loader .dot:nth-child(3) { animation-delay: 0s; }
        @keyframes ai-loader-pulse { 0%, 80%, 100% { transform: scale(0); opacity: 0.5; } 40% { transform: scale(1.0); opacity: 1; } }


        /* Code Blocks */
        .message pre { background-color: var(--code-bg); color: var(--text-primary); padding: 15px; border-radius: var(--border-radius-small); overflow-x: auto; margin: 10px 0 5px 0; position: relative; line-height: var(--prism-line-height, 1.4); font-size: 0.9em; border: 1px solid var(--border-color);}
        .message code { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 1em; white-space: pre; display: block; }
        .message pre[class*="language-"] { background-color: var(--code-bg) !important; border: none; margin: 0; padding: 0; }
        .message pre code[class*="language-"] { color: var(--text-primary); text-shadow: none; }
        .copy-code-btn { position: absolute; top: 8px; right: 8px; background-color: color-mix(in srgb, var(--bg-tertiary) 70%, transparent); color: var(--text-secondary); padding: 4px 8px; font-size: 0.8em; border-radius: 4px; opacity: 0; transition: opacity 0.2s ease, background-color 0.2s ease; z-index: 1; border: 1px solid var(--border-color); }
        .message pre:hover .copy-code-btn { opacity: 1; }
        .copy-code-btn:hover { background-color: var(--bg-tertiary); color: var(--text-primary); }

        /* Message Actions */
        .message-actions { display: flex; justify-content: flex-start; gap: 5px; position: absolute; bottom: 4px; left: 55px; opacity: 0; transition: opacity 0.2s ease; pointer-events: none; z-index: 5; background: none; padding: 0; border-radius: 0; }
        .user-message .message-actions { left: auto; right: 55px; justify-content: flex-end; }
        .message:hover .message-actions { opacity: 1; pointer-events: auto; }
        .message-actions button { padding: 4px; background: none; border-radius: 50%; line-height: 0; border: none; transition: background-color 0.2s ease, color 0.2s ease; }
        .message-actions button:hover { background-color: var(--bg-tertiary); }
        .message-actions button svg { width: 16px; height: 16px; stroke: currentColor; }
        .message-actions button.active { color: var(--accent-primary); }
        .user-message .message-actions button { color: #A0A0B0; }
        .user-message .message-actions button:hover { color: #FFFFFF; background-color: color-mix(in srgb, var(--accent-primary) 80%, black); }
        .ai-message .message-actions button { color: var(--text-secondary); }
        .ai-message .message-actions button:hover { color: var(--text-primary); background-color: var(--bg-tertiary); }

        /* Edit Mode Styling */
        .edit-textarea { width: calc(100% + 16px); margin: -8px -8px 8px -8px; min-height: 60px; font-family: inherit; font-size: inherit; border: 1px solid var(--border-color); border-radius: 4px; padding: 8px; background-color: var(--bg-tertiary); color: var(--text-primary); resize: none; display: block; line-height: 1.5; box-shadow: none; overflow-y: auto; outline: none; }
        .edit-controls { display: flex; justify-content: flex-end; gap: 8px; margin-top: 8px; }
        .edit-controls button { font-size: 0.9em; padding: 6px 12px; }
        .save-edit-btn { background-color: var(--success-color); color: white; }
        .cancel-edit-btn { background-color: var(--bg-secondary); border: 1px solid var(--border-color); }
        .save-edit-btn:hover { background-color: color-mix(in srgb, var(--success-color) 90%, black); }
        .cancel-edit-btn:hover { background-color: var(--bg-tertiary); }

        /* Input Area */
        .input-area { padding: 15px 20px; border-radius: 20px; border-top: 1px solid var(--border-color); background-color: var(--bg-primary); flex-shrink: 0; transition: border-color 0.3s ease, background-color 0.3s ease; }
        .file-preview-container { display: none; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; max-height: 80px; overflow-y: auto; }
        .file-preview-container.visible { display: flex; }
        .file-preview-item { background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: var(--border-radius-small); padding: 4px 8px; display: flex; align-items: center; gap: 5px; font-size: 0.85em; max-width: 180px; }
        .file-preview-item .file-name { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex-grow: 1; }
        .file-preview-item .remove-file-btn { background: none; border: none; color: var(--text-secondary); font-size: 1.2em; padding: 0 2px; margin-left: auto; line-height: 1; cursor: pointer; }
        .file-preview-item .remove-file-btn:hover { color: var(--error-color); }

        .input-wrapper { display: flex; align-items: flex-end; background-color: var(--bg-secondary); border-radius: var(--border-radius); padding: 5px; border: 1px solid var(--border-color); transition: border-color 0.2s ease; }
        .input-wrapper:focus-within { border-color: var(--accent-primary); }
        #message-input { flex-grow: 1; border: none; background: transparent; color: var(--text-primary); padding: 10px; resize: none; outline: none; max-height: 150px; overflow-y: auto; line-height: 1.5; height: auto; }
        #message-input::placeholder { color: var(--text-placeholder); }

        .upload-btn, .send-btn, .mic-btn { padding: 8px; margin: 3px; color: var(--text-secondary); flex-shrink: 0; border-radius: var(--border-radius-small); background: none; border: none; }
        .upload-btn:hover:not(:disabled), .send-btn:hover:not(:disabled), .mic-btn:hover:not(:disabled) { color: var(--text-primary); background-color: var(--bg-tertiary); }
        .send-btn { color: var(--accent-primary); }
        .send-btn:hover:not(:disabled) { color: var(--accent-primary-hover); }
        .send-btn:disabled { color: var(--text-secondary); opacity: 0.5; cursor: not-allowed; background: none; }
        .mic-btn svg { width: 20px; height: 20px; }
        .mic-btn.recording { color: var(--error-color); }
        .mic-btn.recording:hover { background-color: color-mix(in srgb, var(--error-color) 20%, var(--bg-tertiary)); }
        .upload-btn svg, .send-btn svg, .mic-btn svg { width: 20px; height: 20px; }


        /* Modals */
        .modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6); display: none; align-items: center; justify-content: center; z-index: 1050; opacity: 0; transition: opacity 0.3s ease, visibility 0.3s ease; padding: 20px; visibility: hidden; }
        .modal-overlay.show { display: flex; opacity: 1; visibility: visible; }
        .modal { background-color: var(--bg-modal); color: var(--text-primary); border-radius: var(--border-radius); box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25); width: 100%; max-width: var(--modal-max-width); max-height: calc(100vh - 40px); display: flex; flex-direction: column; overflow: hidden; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.show .modal { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
        .modal-header h3 { font-size: 1.2em; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .modal-header h3 svg { color: var(--text-secondary); }
        .modal-close-btn { background: none; border: none; color: var(--text-secondary); padding: 5px; border-radius: 50%; }
        .modal-close-btn:hover { color: var(--text-primary); background-color: var(--bg-tertiary); }
        .modal-close-btn svg { width: 20px; height: 20px; }
        .modal-body { display: flex; flex-grow: 1; overflow: hidden; /* For modals with nav/content side-by-side */ }
        .modal-body.modal-body-full { overflow-y: auto; /* For modals with just one scrollable content area */ flex-direction: column; padding: 20px; }
        .modal-nav { width: 200px; flex-shrink: 0; padding: 20px 0; border-right: 1px solid var(--border-color); display: flex; flex-direction: column; overflow-y: auto; }
        .modal-nav-item { width: 100%; padding: 12px 20px; font-size: 0.95em; border-radius: 0; text-align: left; justify-content: flex-start; color: var(--text-secondary); }
        .modal-nav-item svg { margin-right: 10px; color: var(--text-secondary); }
        .modal-nav-item.active { background-color: var(--accent-primary); color: white; font-weight: 500; }
        .modal-nav-item.active svg { color: white; }
        .modal-nav-item:not(.active):hover { background-color: var(--bg-tertiary); color: var(--text-primary); }
        .modal-nav-item:not(.active):hover svg { color: var(--text-primary); }
        .modal-content { flex-grow: 1; padding: 25px 30px; overflow-y: auto; }
        .modal-section { display: none; }
        .modal-section.active { display: block; }
        .modal-section h4 { font-size: 1.3em; font-weight: 600; margin-bottom: 8px; }
        .modal-section .section-description { font-size: 0.95em; color: var(--text-secondary); margin-bottom: 25px; }
        .form-group { margin-bottom: 20px; }
        .form-group > label:not(.toggle-switch-label) { display: block; font-weight: 500; margin-bottom: 8px; font-size: 0.9em; }
        .form-group .description { font-size: 0.85em; color: var(--text-secondary); margin-top: 5px; }
        .form-group .description.small { font-size: 0.8em; margin-top: 3px; }
        .form-row { display: flex; gap: 20px; flex-wrap: wrap; }
        .form-row .form-group { flex: 1; width: 100%; }
        .profile-picture-group { display: flex; align-items: center; gap: 15px; }
        .api-key-group .api-key-input { display: flex; gap: 10px; align-items: center; }
        .api-key-group input[type="password"] { flex-grow: 1; background-color: var(--bg-primary); }
        .toggle-group { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); gap: 15px; }
        .toggle-group:last-child { border-bottom: none; }
        .toggle-group > div { flex-grow: 1; }
        .toggle-group > div > label { font-weight: 500; display: block; margin-bottom: 4px; font-size: 0.95em; }
        .toggle-group .description { margin-top: 0; font-size: 0.85em; }
        .toggle-switch { position: relative; display: inline-block; width: 44px; height: 24px; flex-shrink: 0; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--toggle-bg-off); transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: var(--toggle-slider); transition: .4s; }
        input:checked + .slider { background-color: var(--toggle-bg-on); }
        input:focus + .slider { box-shadow: 0 0 1px var(--toggle-bg-on); }
        input:checked + .slider:before { transform: translateX(20px); }
        .slider.round { border-radius: 24px; }
        .slider.round:before { border-radius: 50%; }
        .theme-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 10px; }
        .theme-option { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 15px; border: 2px solid var(--border-color); background-color: var(--bg-secondary); border-radius: var(--border-radius-small); gap: 10px; font-size: 0.9em; text-align: center; cursor: pointer; transition: border-color 0.2s ease, background-color 0.2s ease; }
        .theme-option svg { width: 32px; height: 32px; color: var(--text-secondary); margin-bottom: 5px; }
        .theme-option.active { border-color: var(--accent-primary); background-color: color-mix(in srgb, var(--accent-primary) 10%, var(--bg-secondary)); }
        .theme-option.active svg { color: var(--accent-primary); }
        .theme-option:hover:not(.active) { border-color: var(--border-color-light); background-color: var(--bg-tertiary); }
        .accent-color-options { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 10px; }
        .accent-color-option { width: 32px; height: 32px; border-radius: 50%; border: 3px solid transparent; padding: 0; min-width: 32px; box-shadow: 0 0 0 1px var(--border-color-light) inset; cursor: pointer; transition: border-color 0.2s ease, box-shadow 0.2s ease; }
        .accent-color-option.active { border-color: var(--bg-modal); box-shadow: 0 0 0 3px var(--text-primary); }
        .accent-color-option:hover:not(.active) { border-color: var(--bg-modal); box-shadow: 0 0 0 2px var(--text-secondary); }
        .current-plan-card { background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 20px; margin-bottom: 30px; }
        .plan-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .plan-header h5 { font-size: 1.1em; font-weight: 600; margin-bottom: 2px; }
        .plan-header p { font-size: 0.9em; color: var(--text-secondary); }
        .plan-price { text-align: right; }
        .plan-price-amount { font-size: 1.5em; font-weight: 600; color: var(--text-primary); display: block; }
        .plan-price .price-interval { font-size: 0.7em; font-weight: 400; color: var(--text-secondary); }
        .renewal-date { font-size: 0.8em !important; color: var(--text-secondary); margin-top: 4px; }
        .usage-meters { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; }
        .usage-meter label { font-size: 0.85em; color: var(--text-secondary); margin-bottom: 5px; display: flex; align-items: center; gap: 5px; font-weight: 500; }
        .usage-meter progress { width: 100%; height: 8px; border-radius: 4px; overflow: hidden; background-color: var(--progress-bg); border: none; margin-bottom: 5px; appearance: none; }
        .usage-meter progress::-webkit-progress-bar { background-color: var(--progress-bg); border-radius: 4px; }
        .usage-meter progress::-webkit-progress-value { background-color: var(--progress-value); border-radius: 4px; transition: background-color 0.3s ease; }
        .usage-meter progress::-moz-progress-bar { background-color: var(--progress-value); border-radius: 4px; transition: background-color 0.3s ease; }
        .usage-meter span { font-size: 0.8em; color: var(--text-secondary); }
        .plan-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 20px; }
        .plan-card { background-color: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 20px; display: flex; flex-direction: column; }
        .plan-card h5 { font-size: 1.2em; font-weight: 600; margin-bottom: 5px; }
        .plan-card .plan-price { font-size: 1.3em; font-weight: 500; margin-bottom: 15px; text-align: left; }
        .plan-card ul { list-style: none; margin-bottom: 20px; flex-grow: 1; }
        .plan-card li { font-size: 0.9em; margin-bottom: 8px; color: var(--text-secondary); display: flex; align-items: flex-start; }
        .plan-card li::before { content: "+"; color: var(--accent-primary); margin-right: 8px; font-weight: bold; line-height: 1.5; flex-shrink: 0; }
        .plan-button { width: 100%; margin-top: auto; }
        .contact-form { margin-top: 15px; }
        .contact-submit-btn { width: 100%; margin-top: 10px; }
        .modal-footer { padding: 15px 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; background-color: var(--bg-modal); flex-shrink: 0; }


        /* --- File Upload Modal Specifics --- */
        .file-list-display .file-preview-item { background-color: var(--bg-tertiary); margin-bottom: 5px; padding: 6px 10px; display: flex; align-items: center; gap: 8px; }
        .file-list-display .file-preview-item button { background: none; border: none; line-height: 1; cursor: pointer; flex-shrink: 0; border-radius: var(--border-radius-small); transition: background-color 0.2s ease, color 0.2s ease; }
        .file-list-display .file-preview-item .remove-file-btn { margin-left: auto; color: var(--text-secondary); font-size: 1.3em; padding: 1px 6px; }
        .file-list-display .file-preview-item .remove-file-btn:hover { color: var(--error-color); background-color: var(--bg-secondary); }
        .file-list-display .file-preview-item .add-previous-file-btn { margin-left: auto; color: var(--accent-primary); font-weight: 500; font-size: 0.9em; padding: 3px 8px; }
        .file-list-display .file-preview-item .add-previous-file-btn:hover:not(:disabled) { color: var(--accent-primary-hover); background-color: var(--bg-secondary); }
        .file-list-display .file-preview-item .add-previous-file-btn:disabled { color: var(--text-secondary); cursor: default; opacity: 0.7; background-color: transparent; }
        .file-list-display .file-preview-item .remove-from-previous-list-btn { margin-left: 8px; color: var(--error-color); font-size: 1.3em; padding: 1px 6px; }
        .file-list-display .file-preview-item .remove-from-previous-list-btn:hover { color: color-mix(in srgb, var(--error-color) 80%, black); background-color: var(--bg-secondary); }
        .file-list-display .empty-list-placeholder { padding: 10px; color: var(--text-placeholder); font-size: 0.9em; text-align: center; }
        .file-list-display .file-preview-item .file-name { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex-grow: 1; }

        /* --- Upgrade Plan Modal Styles --- */
        #upgrade-plan-modal {
            max-width: var(--upgrade-modal-max-width);
        }
        .upgrade-plan-toggle-container {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            padding: 4px;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-small);
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .plan-toggle-btn {
            padding: 8px 20px;
            font-size: 0.9em;
            font-weight: 500;
            color: var(--text-secondary);
            background-color: transparent;
            border: none;
            border-radius: var(--border-radius-small);
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .plan-toggle-btn.active {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .light-mode .plan-toggle-btn.active {
            background-color: var(--bg-primary); /* Lighter active state for light mode */
        }

        .upgrade-plan-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .upgrade-plan-cards-container#business-plans-container {
            grid-template-columns: minmax(300px, 500px); /* Team plan is wider */
            justify-content: center;
        }

        .upgrade-plan-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 25px;
            display: flex;
            flex-direction: column;
            position: relative; /* For popular badge */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .upgrade-plan-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px color-mix(in srgb, var(--bg-primary) 80%, transparent);
        }
        .upgrade-plan-card.popular {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px var(--accent-primary);
        }
        .popular-badge {
            position: absolute;
            top: -1px; /* Align with border */
            right: 20px;
            background-color: var(--accent-primary);
            color: white;
            padding: 4px 10px;
            font-size: 0.75em;
            font-weight: 600;
            border-radius: 0 0 var(--border-radius-small) var(--border-radius-small);
            text-transform: uppercase;
        }

        .upgrade-plan-card .plan-title {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        .upgrade-plan-card .plan-price {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        .upgrade-plan-card .plan-price .price-amount {
            font-size: 2em;
            font-weight: 700;
            color: var(--text-primary);
        }
        .upgrade-plan-card .plan-price .price-interval {
            font-size: 0.9em;
            color: var(--text-secondary);
        }
        .upgrade-plan-card .plan-description {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
            min-height: 4.5em; /* approx 3 lines */
        }

        .upgrade-plan-card .plan-action-btn {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            font-weight: 500;
            margin-top: auto; /* Pushes to bottom */
        }
        .upgrade-plan-card .plan-action-btn.current-plan-btn {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            cursor: default;
        }
        .upgrade-plan-card .plan-action-btn.current-plan-btn:hover {
             background-color: var(--bg-tertiary); /* No change on hover */
        }

        .upgrade-plan-card .feature-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
            flex-grow: 1;
        }
        .upgrade-plan-card .feature-list-item {
            display: flex;
            align-items: flex-start;
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.4;
        }
        .upgrade-plan-card .feature-list-item svg { /* Using the checkmark from model selector */
            width: 16px;
            height: 16px;
            margin-right: 10px;
            fill: var(--accent-primary); /* Checkmark color */
            stroke: none;
            flex-shrink: 0;
            margin-top: 2px; /* Align with text */
        }
        .upgrade-plan-card .plan-footnote {
            font-size: 0.8em;
            color: var(--text-placeholder);
            text-align: center;
            margin-top: 15px;
        }
        .upgrade-plan-card .learn-more-link {
            color: var(--accent-primary);
            text-decoration: none;
        }
        .upgrade-plan-card .learn-more-link:hover {
            text-decoration: underline;
        }


        .upgrade-plan-footer {
            text-align: center;
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        .upgrade-plan-footer a {
            color: var(--accent-primary);
            text-decoration: none;
            font-weight: 500;
        }
        .upgrade-plan-footer a:hover {
            text-decoration: underline;
        }
        #business-plans-container { display: none; } /* Hidden by default */

        /* --- Responsiveness --- */
        @media (min-width: 769px) { /* Desktop and larger */
            .sidebar-toggle-btn { display: inline-flex; }
            .mobile-menu-toggle { display: none; }
            .mobile-sidebar-close-btn { display: none; }
        }
        @media (max-width: 992px) { /* Tablet and smaller */
            .modal { max-width: 95%; }
            .modal-body:not(.modal-body-full) { flex-direction: column; } /* Only apply to modals with nav */
            .modal-nav { width: 100%; border-right: none; border-bottom: 1px solid var(--border-color); flex-direction: row; overflow-x: auto; padding: 10px 0; justify-content: flex-start; scrollbar-width: none; }
            .modal-nav::-webkit-scrollbar { height: 0px; }
            .modal-nav-item { white-space: nowrap; padding: 10px 15px;}
            .modal-content { padding: 20px; }
            .prompt-cards-grid { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
            .upgrade-plan-cards-container { grid-template-columns: 1fr; } /* Stack plan cards on tablet */
        }

        @media (max-width: 768px) { /* Mobile */
            :root { --sidebar-width: 240px; }
            .sidebar { position: fixed; left: 0; top: 0; bottom: 0; z-index: 1100; transform: translateX(-100%); border-right: none; box-shadow: 2px 0 10px rgba(0,0,0,0.2); width: var(--sidebar-width) !important; transition: transform 0.3s ease; }
            .sidebar.collapsed { transform: translateX(-100%); }
            body.sidebar-open .sidebar { transform: translateX(0); }
            .mobile-menu-toggle { display: block; opacity: 1; visibility: visible; }
            body.sidebar-open .mobile-menu-toggle { opacity: 0; visibility: hidden; pointer-events: none; }
            .mobile-sidebar-close-btn { display: inline-flex; }
            .sidebar-toggle-btn { display: none !important; }
            .chat-area { width: 100%; }
            .chat-header { justify-content: space-between; padding: 0 15px; border-radius: 50; }
            .mobile-chat-title { display: block; flex-grow: 1; text-align: center; margin: 0 10px; }
            .model-selector-container { margin-left: 0; }
            .model-selector-trigger-btn { padding: 6px; }
            .model-selector-trigger-btn span { display: none; }
            .model-selector-popover { width: 250px; }
            #mobile-new-chat-btn { display: inline-flex; }
            .message { max-width: 95%; padding-bottom: 35px; }
            .input-area { padding: 10px 15px; }
            .initial-prompt-title { font-size: 1.5em; margin-bottom: 20px; }
            .prompt-cards-grid { grid-template-columns: 1fr; }
            .user-profile-popover { width: calc(var(--sidebar-width) - 20px); }
            .form-row { flex-direction: column; gap: 0; }
            .command-suggestions .command-buttons { justify-content: center; padding-left: 0; }
            .command-suggestions p { text-align: center; padding-left: 0;}
            .history-options-btn { opacity: 1; }
            .message-actions { left: 10px; }
            .user-message .message-actions { right: 10px; left: auto; }
            .upgrade-plan-toggle-container { flex-wrap: wrap; justify-content: center; }
            .plan-toggle-btn { flex-grow: 1; min-width: 120px; }
            .upgrade-plan-card .plan-description { min-height: auto; }
        }

        .ai-loader { display: flex; align-items: center; padding: 8px 0px; min-height: 24px; }
        .ai-loader .dot { width: 8px; height: 8px; margin: 0 3px; background-color: var(--accent-primary); border-radius: 50%; animation: ai-loader-pulse 1.4s infinite ease-in-out both; }
        .ai-loader .dot:nth-child(1) { animation-delay: -0.32s; }
        .ai-loader .dot:nth-child(2) { animation-delay: -0.16s; }
        .ai-loader .dot:nth-child(3) { animation-delay: 0s; }
        @keyframes ai-loader-pulse { 0%, 80%, 100% { transform: scale(0); opacity: 0.5; } 40% { transform: scale(1.0); opacity: 1; } }


        pre[class*="language-"] { background: var(--code-bg) !important; color: var(--text-primary) !important; text-shadow: none !important; border: 1px solid var(--border-color); border-radius: var(--border-radius-small); padding: 1em !important; margin: 10px 0 !important; overflow: auto; line-height: 1.5; }
        code[class*="language-"], pre[class*="language-"] { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 0.9em; white-space: pre; word-spacing: normal; word-break: normal; word-wrap: normal; tab-size: 4; hyphens: none; }

        .confirm-dialog-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index: 1060; opacity: 0; transition: opacity 0.2s ease, visibility 0.2s ease; visibility: hidden; }
        .confirm-dialog-overlay.show { display: flex; opacity: 1; visibility: visible; }
        .confirm-dialog { background-color: var(--bg-modal); color: var(--text-primary); padding: 25px 30px; border-radius: var(--border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 90%; max-width: 400px; text-align: center; transform: scale(0.95); transition: transform 0.2s ease; }
        .confirm-dialog-overlay.show .confirm-dialog { transform: scale(1); }
        .confirm-dialog h4 { font-size: 1.2em; margin-bottom: 10px; font-weight: 600; }
        .confirm-dialog p { font-size: 0.95em; color: var(--text-secondary); margin-bottom: 25px; line-height: 1.5; }
        .confirm-dialog-actions { display: flex; justify-content: center; gap: 15px; }
        .confirm-dialog-actions button { padding: 8px 20px; min-width: 100px; }

        /* Fallback generic icons in input area (if preview fails/not applicable) */
.file-preview-container .file-preview-item .file-icon svg:not(.embedded-svg-content):not(.main-input-preview-image):not(.main-input-svg-preview-wrapper svg) {
    width: 18px; height: 18px;
}
/* SVG content rendered as an icon in input area */
.file-preview-container .file-preview-item .file-icon > svg.embedded-svg-content {
    width: auto; height: auto; max-width: 32px; max-height: 32px; stroke-width: initial;
}

/* Styling for the .file-icon span in the INPUT AREA to define preview box size */
.file-preview-container .file-preview-item .file-icon {
    width: 32px;  /* Desired width for input area previews */
    height: 32px; /* Desired height for input area previews */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-radius: var(--border-radius-small);
    /* border: 1px solid var(--border-color-light); /* Optional border for the preview box itself */
    /* background-color: var(--bg-secondary); /* Optional background */
}
/* Image previews specifically in the INPUT AREA */
.file-preview-container .file-preview-item .file-icon > .main-input-preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Ensures the image covers the area, might crop */
}
/* SVG preview container specifically in the INPUT AREA */
.file-preview-container .file-preview-item .file-icon > .main-input-svg-preview-wrapper {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}
/* SVG element itself inside the wrapper in the INPUT AREA */
.file-preview-container .file-preview-item .file-icon > .main-input-svg-preview-wrapper > svg {
    max-width: 100%;
    max-height: 100%;
}


/* Fallback generic icons in modal's "Selected Files" list */
.file-list-display .file-preview-item .file-icon svg:not(.embedded-svg-content):not(.file-preview-image):not(.file-preview-svg-container svg) {
    width: 18px; height: 18px;
}
/* SVG content rendered as an icon in modal's "Selected Files" list */
.file-list-display .file-preview-item .file-icon > svg.embedded-svg-content {
     width: auto; height: auto; max-width: 36px; max-height: 36px; stroke-width: initial;
}
/* Styling for the .file-icon span in the MODAL "Selected Files" list */
.file-list-display .file-preview-item .file-icon {
    width: 36px; /* Size for modal previews */
    height: 36px; /* Size for modal previews */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border: 1px solid var(--border-color-light);
    border-radius: var(--border-radius-small);
    background-color: var(--bg-secondary);
}
/* Image previews specifically in the MODAL "Selected Files" list */
.file-list-display .file-preview-item .file-icon > .file-preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
/* SVG preview container specifically in the MODAL "Selected Files" list */
.file-list-display .file-preview-item .file-icon > .file-preview-svg-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}
/* SVG element itself inside the wrapper in the MODAL "Selected Files" list */
.file-list-display .file-preview-item .file-icon > .file-preview-svg-container > svg {
    max-width: 100%;
    max-height: 100%;
}


/* --- File Icons/Previews in MESSAGES --- */
/* Fallback generic icons in message attachments */
.message-attachment-item .file-icon > svg:not(.embedded-svg-content):not(.message-preview-image):not(.message-preview-svg-container svg) {
    width: 18px; height: 18px;
}
/* SVG content rendered as an icon in message attachments */
.message-attachment-item .file-icon > svg.embedded-svg-content {
    width: auto; height: auto; max-width: 50px; max-height: 50px; stroke-width: initial;
}
/* Styling for the .file-icon span in MESSAGE ATTACHMENTS to define preview box size */
.message-attachment-item .file-icon {
    width: 60px;  /* Desired width for message attachment previews */
    height: 60px; /* Desired height for message attachment previews */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-radius: var(--border-radius-small);
    /* The border and background are handled by .message-attachment-item styles already */
}
/* Image previews specifically in MESSAGE ATTACHMENTS */
.message-attachment-item .file-icon > .message-preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
/* SVG preview container specifically in MESSAGE ATTACHMENTS */
.message-attachment-item .file-icon > .message-preview-svg-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}
/* SVG element itself inside the wrapper in MESSAGE ATTACHMENTS */
.message-attachment-item .file-icon > .message-preview-svg-container > svg {
    max-width: 100%;
    max-height: 100%;
}